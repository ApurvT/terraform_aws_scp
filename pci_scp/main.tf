# The below approved services are based off the list located here: https://aws.amazon.com/compliance/services-in-scope/
resource "aws_organizations_policy" "allow_pci_services" {
  name        = "Allow PCI Services"
  description = "Only allow PCI services as of 6/22/2020"

  content = <<CONTENT
{
  "Version": "2012-10-17",
  "Statement": [
    {
    "Effect": "Allow",
    "Action": [
      "acm:*",
      "amplify:*",
      "apigateway:*",
      "appmesh:*",
      "appstream:*",
      "appsync:*",
      "athena:*",
      "autoscaling:*",
      "backup:*",
      "batch:*",
      "cassandra:*",
      "chatbot:*",
      "clouddirectory:*",
      "cloudformation:*",
      "cloudfront:*",
      "cloudhsm:*",
      "cloudtrail:*",
      "cloudwatch:*",
      "codebuild:*",
      "codecommit:*",
      "codedeploy:*",
      "codepipeline:*",
      "cognito-identity:*",
      "cognito-idp:*",
      "cognito-sync:*",
      "comprehend:*",
      "comprehendmedical:*",
      "config:*",
      "connect:*",
      "databrew:*",
      "dataexchange:*",
      "datasync:*",
      "directconnect:*",
      "dms:*",
      "ds:*",
      "dynamodb:*",
      "ebs:*",
      "ec2:*",
      "ecr:*",
      "ecs:*",
      "eks:*",
      "elasticache:*",
      "elasticbeanstalk:*",
      "elasticfilesystem:*",
      "elasticloadbalancing:*",
      "elasticmapreduce:*",
      "es:*",
      "events:*",
      "firehose:*",
      "fms:*",
      "forecast:*",
      "freertos:*",
      "fsx:*",
      "glacier:*",
      "globalaccelerator:*",
      "glue:*",
      "greengrass:*",
      "groundstation:*",
      "guardduty:*",
      "health:*",
      "iam:*",
      "importexport:*",
      "inspector:*",
      "iot:*",
      "iotevents:*",
      "kafka:*",
      "kendra:*",
      "kinesis:*",
      "kinesisanalytics:*",
      "kinesisvideo:*",
      "kms:*",
      "lakeformation:*",
      "lambda:*",
      "lex:*",
      "license-manager:*",
      "logs:*",
      "macie:*",
      "mediaconnect:*",
      "mediaconvert:*",
      "medialive:*",
      "mq:*",
      "neptune-db:*",
      "opsworks-cm:*",
      "opsworks:*",
      "organizations:*",
      "outposts:*",
      "personalize:*",
      "polly:*",
      "quicksight:*",
      "rds:*",
      "redshift:*",
      "rekognition:*",
      "resource-groups:*",
      "robomaker:*",
      "route53:*",
      "s3:*",
      "sagemaker:*",
      "sdb:*",
      "secretsmanager:*",
      "securityhub:*",
      "serverlessrepo:*",
      "servicecatalog:*",
      "shield:*",
      "sms:*",
      "snowball:*",
      "sns:*",
      "sqs:*",
      "ssm:*",
      "states:*",
      "storagegateway:*",
      "swf:*",
      "textract:*",
      "timestream:*",
      "transcribe:*",
      "transfer:*",
      "translate:*",
      "trustedadvisor:*",
      "waf:*",
      "workdocs:*",
      "worklink:*",
      "workspaces:*",
      "xray:*"
    ],
    "Resource": "*"
    }
  ]
}
CONTENT

}

resource "aws_organizations_policy_attachment" "allow_pci_services_attachment" {
  policy_id = aws_organizations_policy.allow_pci_services.id
  target_id = var.target_id
}

